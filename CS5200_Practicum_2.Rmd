---
title: "Practicum_Two"
output:
  pdf_document: default
  html_notebook: default
---
# Create database schema
## Connect to database
```{r}
library(RSQLite)

dbFile = "./Practicum2.sqlite"

dbcon <- dbConnect(RSQLite::SQLite(), dbFile)
```

## Create table Author
```{sql connection=dbcon}
DROP TABLE IF EXISTS Author;
```

```{sql connection=dbcon}
CREATE TABLE Author (
  authorId INTEGER PRIMARY KEY,
  lastName TEXT,
  foreName TEXT,
  initials TEXT
);
```

## Create table Jounal
```{sql connection=dbcon}
DROP TABLE IF EXISTS Journal;
```

```{sql connection=dbcon}
CREATE TABLE Journal (
  ISSN TEXT PRIMARY KEY,
  title TEXT NOT NULL,
  isoabbreviation TEXT NOT NULL,
);
```


# Loading Libraries

```{r warning=FALSE}
library(XML)
library(xslt)
#library(DBI)
#library(knitr)
#library(sqldf)
#options(sqldf.driver = "SQLite")
#options(warn=-1)
```

# Load XML data to database
## Read XML file
```{r}
xmlPath <- "./pubmed_sample.xml"
xmlDoc = read_xml(xmlPath)
```

## Load Journal table
```{r}
# Extract Journal Data
xslPath = "./journal.xsl"
xslDoc = read_xml(xslPath,package="xslt")
journal_raw = xml_xslt(xmlDoc,xslDoc)
journals = unique(xmlToDataFrame(XML::xmlParse(journal_raw)))
dbWriteTable(dbcon,name = "Journal", value = journals, append = TRUE)
```

## Load Author table
```{r}
# Extract Journal Data
xslPath = "./author.xsl"
xslDoc = read_xml(xslPath,package="xslt")
author_raw = xml_xslt(xmlDoc,xslDoc)
authors = unique(xmlToDataFrame(XML::xmlParse(author_raw)))
authors = cbind(authorId=rownames(authors),authors)
dbWriteTable(dbcon,name = "Author", value = authors, append = TRUE)
```




